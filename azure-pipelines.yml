jobs:
- job: test
  displayName: 'Lint'

  pool:
    vmImage: 'Ubuntu 16.04'

  steps:
  - script: sudo apt-get install docker python-setuptools
    displayName: 'Install base dependencies'

  - script: docker build -t cd-bot .
    displayName: 'Build docker container'

  - script: pip install -r requirements-ci.txt
    displayName: 'Install project using pip'

  - script: python -m flake8 .
    displayName: 'Run linter'

- job: test
  displayName: 'Test'
  
  pool:
    vmImage: 'Ubuntu 16.04'

- job: build
  displayName: 'Deploy'
  dependsOn: 
    - 'lint'
    - 'test'

  pool:
    vmImage: 'Ubuntu 16.04'

  steps:
  - task: ShellScript@2
    displayName: 'Build and deploy containers'

    inputs:
      scriptPath: deploy.sh
